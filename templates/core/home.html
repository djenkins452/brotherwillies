{% extends "base.html" %}
{% load tz_extras %}
{% block title %}Brother Willies - Home{% endblock %}

{% block content %}
<h1 class="page-title">Dashboard</h1>

{% if cbb_live_data or cfb_live_data %}
<p class="section-title section-title-live"><span class="live-dot"></span> Live Now</p>
<div class="card-grid">
    {% for g in cbb_live_data %}
    <a href="/cbb/game/{{ g.game.id }}/" class="game-card game-card-live">
        <span class="badge badge-live">Live</span>
        {% if g.is_favorite %}
        <span class="badge badge-fav">Your Team</span>
        {% endif %}
        <div class="teams">
            <span class="team-name">{{ g.game.away_team.name }}</span>
            {% if g.game.away_score is not None %}<span class="game-score">{{ g.game.away_score }}</span>{% endif %}
            <span class="vs">@</span>
            <span class="team-name">{{ g.game.home_team.name }}</span>
            {% if g.game.home_score is not None %}<span class="game-score">{{ g.game.home_score }}</span>{% endif %}
        </div>
        <div class="edge-row">
            <span>Mkt: {{ g.market_prob|floatformat:0 }}%</span>
            <span>House: <span class="{% if g.house_edge > 0 %}edge-positive{% elif g.house_edge < 0 %}edge-negative{% else %}edge-neutral{% endif %}">{{ g.house_edge|floatformat:1 }}%</span></span>
        </div>
    </a>
    {% endfor %}
    {% for g in cfb_live_data %}
    <a href="/cfb/game/{{ g.game.id }}/" class="game-card game-card-live">
        <span class="badge badge-live">Live</span>
        {% if g.is_favorite %}
        <span class="badge badge-fav">Your Team</span>
        {% endif %}
        <div class="teams">
            <span class="team-name">{{ g.game.away_team.name }}</span>
            {% if g.game.away_score is not None %}<span class="game-score">{{ g.game.away_score }}</span>{% endif %}
            <span class="vs">@</span>
            <span class="team-name">{{ g.game.home_team.name }}</span>
            {% if g.game.home_score is not None %}<span class="game-score">{{ g.game.home_score }}</span>{% endif %}
        </div>
        <div class="edge-row">
            <span>Mkt: {{ g.market_prob|floatformat:0 }}%</span>
            <span>House: <span class="{% if g.house_edge > 0 %}edge-positive{% elif g.house_edge < 0 %}edge-negative{% else %}edge-neutral{% endif %}">{{ g.house_edge|floatformat:1 }}%</span></span>
        </div>
    </a>
    {% endfor %}
</div>
<hr class="section-divider">
{% endif %}

{% if cbb_games_data %}
<p class="section-title">Top CBB Value Games</p>
<div class="card-grid">
    {% for g in cbb_games_data %}
    <a href="/cbb/game/{{ g.game.id }}/" class="game-card">
        {% if g.is_favorite %}
        <span class="badge badge-fav">Your Team</span>
        {% endif %}
        <div class="teams">
            <span class="team-name">{{ g.game.away_team.name }}</span>
            <span class="vs">@</span>
            <span class="team-name">{{ g.game.home_team.name }}</span>
        </div>
        <div class="game-meta">
            <span>{{ g.game.tipoff|date:"D M d, g:i A" }} {% tz_abbr %}</span>
            <span class="badge badge-{{ g.confidence_class }}">{{ g.confidence }}</span>
        </div>
        <div class="edge-row">
            <span>Mkt: {{ g.market_prob|floatformat:0 }}%</span>
            <span>House: <span class="{% if g.house_edge > 0 %}edge-positive{% elif g.house_edge < 0 %}edge-negative{% else %}edge-neutral{% endif %}">{{ g.house_edge|floatformat:1 }}%</span></span>
        </div>
    </a>
    {% endfor %}
</div>
<div class="mt-2 text-center">
    <a href="/cbb/value/" class="btn btn-secondary btn-sm">View CBB Value Board</a>
</div>
{% endif %}

{% if cfb_games_data %}
<p class="section-title {% if cbb_games_data %}mt-3{% endif %}">Top CFB Value Games</p>
<div class="card-grid">
    {% for g in cfb_games_data %}
    <a href="/cfb/game/{{ g.game.id }}/" class="game-card">
        {% if g.is_favorite %}
        <span class="badge badge-fav">Your Team</span>
        {% endif %}
        <div class="teams">
            <span class="team-name">{{ g.game.away_team.name }}</span>
            <span class="vs">@</span>
            <span class="team-name">{{ g.game.home_team.name }}</span>
        </div>
        <div class="game-meta">
            <span>{{ g.game.kickoff|date:"D M d, g:i A" }} {% tz_abbr %}</span>
            <span class="badge badge-{{ g.confidence_class }}">{{ g.confidence }}</span>
        </div>
        <div class="edge-row">
            <span>Mkt: {{ g.market_prob|floatformat:0 }}%</span>
            <span>House: <span class="{% if g.house_edge > 0 %}edge-positive{% elif g.house_edge < 0 %}edge-negative{% else %}edge-neutral{% endif %}">{{ g.house_edge|floatformat:1 }}%</span></span>
        </div>
    </a>
    {% endfor %}
</div>
<div class="mt-2 text-center">
    <a href="/value/" class="btn btn-secondary btn-sm">View CFB Value Board</a>
</div>
{% endif %}

{% if not cfb_games_data and not cbb_games_data and not cfb_live_data and not cbb_live_data %}
<div class="empty-state">
    <p>No upcoming games right now. Seed demo data to get started.</p>
</div>
{% endif %}

{% if not user.is_authenticated %}
<div class="login-gate mt-2">
    <p>Log in to unlock the full Value Board, model tuning, and personal analytics.</p>
    <a href="/accounts/login/" class="btn btn-primary btn-sm">Log In</a>
</div>
{% endif %}
{% endblock %}
